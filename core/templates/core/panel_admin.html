{% extends "core/base.html" %}
{% load humanize %}  {# para intcomma #}

{% block content %}
<div class="container py-5">

  <!-- Encabezado -->
  <div class="mb-4 p-4 rounded-3 border bg-light">
    <h2 class="mb-1 fw-bold">Panel de Administración</h2>
    <p class="mb-0 text-muted">
      Bienvenido, <strong>{{ user.get_full_name|default:user.username }}</strong>
    </p>
  </div>

  <!-- KPIs -->
  <div class="row g-3 mb-5">

    <!-- Reservas agendadas para hoy -->
    <div class="col-6 col-md-3">
      <div class="card h-100 border-0 shadow-sm"
           style="border-left: 4px solid #0d6efd;">
        <div class="card-body">
          <div class="text-muted small mb-1">Reservas para hoy</div>
          <div class="h3 mb-1 fw-bold">{{ reservas_hoy }}</div>
          <div class="small text-muted">Se juegan hoy</div>
        </div>
      </div>
    </div>

    <!-- Reservas creadas hoy -->
    <div class="col-6 col-md-3">
      <div class="card h-100 border-0 shadow-sm"
           style="border-left: 4px solid #198754;">
        <div class="card-body">
          <div class="text-muted small mb-1">Reservas creadas hoy</div>
          <div class="h3 mb-1 fw-bold text-success">{{ reservas_creadas_hoy }}</div>
          <div class="small text-muted">Nuevas reservas</div>
        </div>
      </div>
    </div>

    <!-- Próximos 7 días -->
    <div class="col-6 col-md-3">
      <div class="card h-100 border-0 shadow-sm"
           style="border-left: 4px solid #ffc107;">
        <div class="card-body">
          <div class="text-muted small mb-1">Próximos 7 días</div>
          <div class="h3 mb-1 fw-bold text-warning">{{ reservas_proximas_7 }}</div>
          <div class="small text-muted">Agenda cercana</div>
        </div>
      </div>
    </div>

    <!-- Canchas / Usuarios -->
    <div class="col-6 col-md-3">
      <div class="card h-100 border-0 shadow-sm"
           style="border-left: 4px solid #6c757d;">
        <div class="card-body">
          <div class="text-muted small mb-1">Canchas activas</div>
          <div class="h3 mb-1 fw-bold">{{ total_canchas }}</div>
          <div class="small text-muted">
            Usuarios activos: <strong>{{ usuarios_activos }}</strong>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Ingresos (desplegable) -->
  <div class="accordion mb-5" id="accordionIngresos">
    <div class="accordion-item border-0 shadow-sm">
      <h2 class="accordion-header" id="headingIngresos">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapseIngresos"
                aria-expanded="false"
                aria-controls="collapseIngresos">
          Ingresos por periodo
        </button>
      </h2>
      <div id="collapseIngresos"
           class="accordion-collapse collapse"
           aria-labelledby="headingIngresos"
           data-bs-parent="#accordionIngresos">
        <div class="accordion-body">

          <div class="row g-3">

            <!-- Últimos 7 días -->
            <div class="col-12 col-md-6 col-lg-3">
              <div class="card h-100 border-0 shadow-sm"
                   style="border-top: 4px solid #0d6efd;">
                <div class="card-body">
                  <div class="text-muted small mb-1">
                    Ingresos últimos 7 días
                  </div>
                  <div class="h4 fw-bold text-primary mb-1">
                    ${{ ingresos_7d|floatformat:0|intcomma }}
                  </div>
                  <div class="small text-muted">
                    Desde {{ hace_7_dias|date:"d-m-Y" }}<br>
                    Hasta {{ hoy|date:"d-m-Y" }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Mes actual -->
            <div class="col-12 col-md-6 col-lg-3">
              <div class="card h-100 border-0 shadow-sm"
                   style="border-top: 4px solid #198754;">
                <div class="card-body">
                  <div class="text-muted small mb-1">
                    Ingresos mes actual
                  </div>
                  <div class="h4 fw-bold text-success mb-1">
                    ${{ ingresos_mes_actual|floatformat:0|intcomma }}
                  </div>
                  <div class="small text-muted">
                    Del {{ start_mes_actual|date:"d-m-Y" }}<br>
                    al {{ end_mes_actual|date:"d-m-Y" }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Mes anterior -->
            <div class="col-12 col-md-6 col-lg-3">
              <div class="card h-100 border-0 shadow-sm"
                   style="border-top: 4px solid #fd7e14;">
                <div class="card-body">
                  <div class="text-muted small mb-1">
                    Ingresos mes anterior
                  </div>
                  <div class="h4 fw-bold text-warning mb-1">
                    ${{ ingresos_mes_anterior|floatformat:0|intcomma }}
                  </div>
                  <div class="small text-muted">
                    Del {{ start_mes_anterior|date:"d-m-Y" }}<br>
                    al {{ end_mes_anterior|date:"d-m-Y" }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Semestre actual -->
            <div class="col-12 col-md-6 col-lg-3">
              <div class="card h-100 border-0 shadow-sm"
                   style="border-top: 4px solid #6f42c1;">
                <div class="card-body">
                  <div class="text-muted small mb-1">
                    Ingresos semestre actual
                  </div>
                  <div class="h4 fw-bold text-dark mb-1">
                    ${{ ingresos_semestre|floatformat:0|intcomma }}
                  </div>
                  <div class="small text-muted">
                    Del {{ start_semestre|date:"d-m-Y" }}<br>
                    al {{ end_semestre|date:"d-m-Y" }}
                  </div>
                </div>
              </div>
            </div>

          </div> <!-- /row -->

        </div>
      </div>
    </div>
  </div>

  <!-- Bloques principales -->
  <div class="row g-4 mb-5">

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <h5 class="fw-bold mb-2">Analytics / BI</h5>
          <p class="text-muted mb-4">
            Revisa métricas de reservas, ingresos y horarios pico en tu dashboard de Looker Studio.
          </p>
          <div class="mt-auto">
            <a href="{% url 'bi_dashboard' %}" class="btn btn-primary">
              Abrir Dashboard BI
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <h5 class="fw-bold mb-2">Administración del sitio</h5>
          <p class="text-muted mb-4">
            Gestiona canchas, usuarios y reservas desde el administrador de Django.
          </p>
          <div class="mt-auto">
            <a href="{% url 'admin:index' %}" class="btn btn-outline-secondary">
              Ir al panel de Django
            </a>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Atajos rápidos -->
  <div class="mb-2 d-flex justify-content-between align-items-center">
    <h6 class="text-uppercase text-muted mb-0">Atajos rápidos</h6>
  </div>

  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-sm btn-outline-primary" href="{% url 'canchas' %}">
      Ver canchas
    </a>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'mis_reservas' %}">
      Mis reservas
    </a>
  </div>

</div>
{% endblock %}
